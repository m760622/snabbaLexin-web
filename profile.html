<!DOCTYPE html>
<html lang="sv" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Min Profil / Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ - SnabbaLexin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="profile.css">
</head>

<body>
    <header>
        <button class="back-btn" onclick="window.history.back()" aria-label="Tillbaka" title="Tillbaka">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        </button>
        <h1>Min Profil / Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h1>
        <div class="header-spacer"></div>
    </header>

    <div class="container">
        <!-- Profile Hero -->
        <div class="profile-hero">
            <div class="avatar">ğŸ“</div>
            <h2 id="userName">InlÃ¤rare</h2>
            <div class="level-badge" id="userLevel">ğŸŒŸ NivÃ¥ 1 - NybÃ¶rjare</div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="streakValue">0</div>
                <div class="stat-label">ğŸ”¥ Dagar / Ø£ÙŠØ§Ù…</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="wordsValue">0</div>
                <div class="stat-label">ğŸ“– Ord / ÙƒÙ„Ù…Ø§Øª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="xpValue">0</div>
                <div class="stat-label">â­ XP</div>
            </div>
        </div>

        <!-- Weekly Activity Chart -->
        <div class="section-card">
            <h3 class="section-title">ğŸ“ˆ Veckoaktivitet / Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
            <div class="weekly-chart" id="weeklyChart">
                <!-- Bars injected by JS -->
            </div>
            <div class="chart-labels">
                <span>MÃ¥n</span><span>Tis</span><span>Ons</span><span>Tor</span><span>Fre</span><span>LÃ¶r</span><span>SÃ¶n</span>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="section-card">
            <h3 class="section-title">ğŸ† Topplista / Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h3>
            <div id="leaderboard">
                <!-- Items injected by JS -->
            </div>
        </div>

        <!-- Achievements -->
        <div class="section-card">
            <h3 class="section-title">ğŸ… Prestationer / Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª <span id="achievementCount"
                    class="achievement-count">(0/12)</span></h3>
            <div class="achievements-grid" id="achievementsGrid">
                <!-- Items injected by JS -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            </svg>
            <span>Hem</span>
        </a>
        <a href="learn.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
            <span>LÃ¤r dig</span>
        </a>
        <a href="games.html" class="nav-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            <span>Spela</span>
        </a>
        <a href="profile.html" class="nav-item active">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Profil</span>
        </a>
    </nav>

    <script>
        // Theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        if (localStorage.getItem('mobileView') === 'true') {
            document.documentElement.classList.add('iphone-mode');
            document.body.classList.add('iphone-view');
        }

        // Load Stats
        function loadStats() {
            const learningStats = JSON.parse(localStorage.getItem('learningStats') || '{"streak": 0, "totalXP": 0}');
            const gamesStats = JSON.parse(localStorage.getItem('gamesStats') || '{"totalScore": 0}');
            const progressData = JSON.parse(localStorage.getItem('progressData') || '{"uniqueWords": 0}');

            document.getElementById('streakValue').textContent = learningStats.streak || 0;
            document.getElementById('wordsValue').textContent = progressData.uniqueWords || 0;
            document.getElementById('xpValue').textContent = (learningStats.totalXP || 0) + (gamesStats.totalScore || 0);

            // Level calculation
            const totalXP = (learningStats.totalXP || 0) + (gamesStats.totalScore || 0);
            const level = Math.floor(totalXP / 100) + 1;
            const levelNames = ['NybÃ¶rjare', 'Studerande', 'Kunnig', 'Expert', 'MÃ¤stare'];
            const levelName = levelNames[Math.min(level - 1, levelNames.length - 1)];
            document.getElementById('userLevel').textContent = `ğŸŒŸ NivÃ¥ ${level} - ${levelName}`;
        }

        // Weekly Chart
        function renderWeeklyChart() {
            const chart = document.getElementById('weeklyChart');
            const weekData = JSON.parse(localStorage.getItem('weeklyActivity') || '[]');

            // Fill with mock data if empty
            const data = weekData.length === 7 ? weekData : [3, 7, 5, 8, 4, 2, 6];
            const maxVal = Math.max(...data, 1);

            chart.innerHTML = data.map((val, i) => {
                const height = (val / maxVal) * 100;
                return `<div class="chart-bar" style="height: ${Math.max(height, 5)}%;" data-value="${val}"></div>`;
            }).join('');
        }

        // Leaderboard (Local simulation)
        function renderLeaderboard() {
            const container = document.getElementById('leaderboard');
            const myXP = parseInt(document.getElementById('xpValue').textContent) || 0;

            // Simulated leaderboard with user in it
            const leaders = [
                { name: 'Ahmad', score: 2450, isYou: false },
                { name: 'Sara', score: 1890, isYou: false },
                { name: 'Mohammed', score: 1650, isYou: false },
                { name: 'Du / Ø£Ù†Øª', score: myXP, isYou: true },
                { name: 'Emma', score: Math.max(myXP - 50, 0), isYou: false }
            ].sort((a, b) => b.score - a.score);

            container.innerHTML = leaders.slice(0, 5).map((user, i) => {
                const rankClasses = ['gold', 'silver', 'bronze', 'other', 'other'];
                return `
                    <div class="leaderboard-item ${user.isYou ? 'you' : ''}">
                        <div class="rank ${rankClasses[i]}">${i + 1}</div>
                        <div class="leaderboard-name">${user.name}</div>
                        <div class="leaderboard-score">${user.score} XP</div>
                    </div>`;
            }).join('');
        }

        // Achievements
        function renderAchievements() {
            const container = document.getElementById('achievementsGrid');
            const unlockedSet = new Set(JSON.parse(localStorage.getItem('unlockedAchievements') || '[]'));

            const achievements = [
                { id: 'first_word', icon: 'ğŸ“–', name: 'FÃ¶rsta ordet' },
                { id: 'streak_3', icon: 'ğŸ”¥', name: '3 dagar' },
                { id: 'streak_7', icon: 'ğŸ†', name: '7 dagar' },
                { id: 'words_50', icon: 'ğŸ“š', name: '50 ord' },
                { id: 'words_100', icon: 'ğŸ’¯', name: '100 ord' },
                { id: 'game_first', icon: 'ğŸ®', name: 'FÃ¶rsta spelet' },
                { id: 'quiz_perfect', icon: 'â­', name: '100% quiz' },
                { id: 'lesson_5', icon: 'ğŸ“', name: '5 lektioner' },
                { id: 'cognates_50', icon: 'ğŸ”¤', name: '50 liknande' },
                { id: 'daily_3', icon: 'ğŸ…', name: '3 utmaningar' },
                { id: 'flashcard_100', icon: 'ğŸƒ', name: '100 kort' },
                { id: 'master', icon: 'ğŸ‘‘', name: 'MÃ¤stare' }
            ];

            let unlockedCount = 0;
            container.innerHTML = achievements.map(a => {
                const isUnlocked = unlockedSet.has(a.id);
                if (isUnlocked) unlockedCount++;
                return `
                    <div class="achievement ${isUnlocked ? 'unlocked' : ''}">
                        <span class="achievement-icon">${a.icon}</span>
                        <span class="achievement-name">${a.name}</span>
                    </div>`;
            }).join('');

            document.getElementById('achievementCount').textContent = `(${unlockedCount}/${achievements.length})`;
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            renderWeeklyChart();
            renderLeaderboard();
            renderAchievements();
        });
    </script>
    <script src="pwa.js" defer></script>
</body>

</html>