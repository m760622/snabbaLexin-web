 :root {
     --primary: #6366f1;
     --primary-dark: #4f46e5;
     --bg-color: #0f172a;
     --card-bg: #1e293b;
     --text-color: #f8fafc;
     --text-muted: #94a3b8;
     --success: #22c55e;
     --warning: #f59e0b;
     --danger: #ef4444;
 }

 [data-theme="light"] {
     --bg-color: #f8fafc;
     --card-bg: #ffffff;
     --text-color: #1e293b;
     --text-muted: #64748b;
 }

 * {
     box-sizing: border-box;
     margin: 0;
     padding: 0;
 }

 body {
     font-family: 'Inter', sans-serif;
     background: var(--bg-color);
     color: var(--text-color);
     min-height: 100vh;
 }

 html.iphone-mode {
     background: var(--bg-color);
 }

 body.iphone-view {
     max-width: 430px;
     margin: 0 auto;
     box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
 }

 /* Header */
 header {
     display: flex;
     align-items: center;
     gap: 0.5rem;
     padding: 0.75rem 1rem;
     background: rgba(30, 41, 59, 0.95);
     -webkit-backdrop-filter: blur(10px);
     backdrop-filter: blur(10px);
     position: sticky;
     top: 0;
     z-index: 100;
 }

 .back-btn,
 .mobile-toggle-btn {
     background: rgba(255, 255, 255, 0.1);
     border: none;
     color: white;
     padding: 0.5rem;
     border-radius: 50%;
     cursor: pointer;
 }

 .mobile-toggle-btn {
     font-size: 1rem;
     padding: 0.4rem 0.6rem;
     border-radius: 8px;
 }

 .mobile-toggle-btn.active {
     background: var(--primary);
 }

 header h1 {
     flex: 1;
     font-size: 1rem;
     text-align: center;
 }

 /* Progress Hero */
 .progress-hero {
     background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
     padding: 1.25rem;
     color: white;
 }

 .hero-stats {
     display: flex;
     justify-content: space-around;
     gap: 1rem;
     margin-bottom: 1rem;
 }

 .hero-stat {
     text-align: center;
 }

 .hero-stat .value {
     font-size: 1.5rem;
     font-weight: 700;
 }

 .hero-stat .label {
     font-size: 0.75rem;
     opacity: 0.9;
 }

 .overall-progress {
     background: rgba(255, 255, 255, 0.2);
     border-radius: 10px;
     height: 8px;
     overflow: hidden;
 }

 .overall-progress .fill {
     height: 100%;
     background: white;
     transition: width 0.5s;
 }

 .progress-text {
     font-size: 0.8rem;
     margin-top: 0.5rem;
     text-align: center;
     opacity: 0.9;
 }

 /* Review Banner */
 .review-banner {
     background: rgba(239, 68, 68, 0.15);
     border: 1px solid rgba(239, 68, 68, 0.3);
     border-radius: 12px;
     padding: 1rem;
     margin: 1rem;
     display: flex;
     align-items: center;
     gap: 1rem;
     cursor: pointer;
     transition: all 0.2s;
 }

 .review-banner:hover {
     background: rgba(239, 68, 68, 0.25);
 }

 .review-banner.hidden {
     display: none;
 }

 .review-icon {
     font-size: 2rem;
 }

 .review-content {
     flex: 1;
 }

 .review-title {
     font-weight: 600;
     color: var(--danger);
 }

 .review-subtitle {
     font-size: 0.85rem;
     color: var(--text-muted);
 }

 main {
     padding: 0 1rem 1rem;
     max-width: 700px;
     margin: 0 auto;
 }

 /* Search & Filter */
 .search-container {
     margin: 1rem 0 0.75rem;
 }

 #lessonSearchInput {
     width: 100%;
     padding: 0.75rem 1.25rem;
     border-radius: 50px;
     border: 2px solid rgba(99, 102, 241, 0.2);
     background: rgba(15, 23, 42, 0.6);
     color: var(--text-color);
     font-size: 1rem;
     transition: all 0.3s;
 }

 #lessonSearchInput:focus {
     outline: none;
     border-color: var(--primary);
     box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
 }

 .filter-scroll-container {
     display: flex;
     overflow-x: auto;
     gap: 0.5rem;
     padding: 0.5rem 0;
     scrollbar-width: none;
 }

 .filter-scroll-container::-webkit-scrollbar {
     display: none;
 }

 .filter-chip {
     padding: 0.4rem 0.9rem;
     border-radius: 20px;
     background: var(--card-bg);
     border: 1px solid rgba(99, 102, 241, 0.2);
     color: var(--text-muted);
     font-size: 0.85rem;
     white-space: nowrap;
     cursor: pointer;
     transition: all 0.2s;
 }

 .filter-chip.active {
     background: var(--primary);
     color: white;
     border-color: var(--primary);
 }

 /* Special Cards */
 .special-section {
     margin-bottom: 1.5rem;
 }

 .section-title {
     font-size: 0.9rem;
     color: var(--text-muted);
     margin-bottom: 0.75rem;
     display: flex;
     align-items: center;
     gap: 0.5rem;
 }

 .special-cards {
     display: grid;
     grid-template-columns: repeat(2, 1fr);
     gap: 0.75rem;
 }

 .special-card {
     background: var(--card-bg);
     border-radius: 12px;
     padding: 1rem;
     cursor: pointer;
     transition: all 0.2s;
     border: 1px solid rgba(99, 102, 241, 0.1);
     text-align: center;
 }

 .special-card:hover {
     border-color: var(--primary);
     transform: translateY(-2px);
 }

 .special-card .icon {
     font-size: 2rem;
     margin-bottom: 0.5rem;
 }

 .special-card .title {
     font-weight: 600;
     font-size: 0.9rem;
     margin-bottom: 0.25rem;
 }

 .special-card .subtitle {
     font-size: 0.75rem;
     color: var(--text-muted);
 }

 /* Lesson Cards */
 .lessons-grid {
     display: grid;
     gap: 0.75rem;
 }

 .lesson-card {
     background: var(--card-bg);
     border-radius: 14px;
     padding: 1rem;
     cursor: pointer;
     transition: all 0.3s;
     border: 1px solid rgba(99, 102, 241, 0.1);
     position: relative;
     display: flex;
     gap: 1rem;
     align-items: center;
 }

 .lesson-card:hover {
     transform: translateY(-2px);
     border-color: var(--primary);
     box-shadow: 0 10px 30px -10px rgba(99, 102, 241, 0.3);
 }

 .lesson-card.completed {
     border-color: var(--success);
     background: rgba(34, 197, 94, 0.05);
 }

 .lesson-card.locked {
     opacity: 0.5;
     pointer-events: none;
 }

 .lesson-icon {
     font-size: 2.25rem;
     flex-shrink: 0;
 }

 .lesson-info {
     flex: 1;
 }

 .lesson-title {
     font-size: 1rem;
     font-weight: 600;
     margin-bottom: 0.2rem;
 }

 .lesson-subtitle {
     font-size: 0.85rem;
     color: var(--primary);
     font-family: 'IBM Plex Sans Arabic', sans-serif;
 }

 .lesson-desc {
     font-size: 0.8rem;
     color: var(--text-muted);
     margin-top: 0.35rem;
     line-height: 1.4;
 }

 .lesson-badge {
     position: absolute;
     top: -8px;
     right: -8px;
     background: var(--success);
     color: white;
     width: 24px;
     height: 24px;
     border-radius: 50%;
     display: flex;
     align-items: center;
     justify-content: center;
     font-size: 0.8rem;
 }

 .lesson-progress {
     position: absolute;
     bottom: 0;
     left: 0;
     right: 0;
     height: 3px;
     background: rgba(99, 102, 241, 0.2);
     border-radius: 0 0 14px 14px;
     overflow: hidden;
 }

 .lesson-progress .fill {
     height: 100%;
     background: var(--primary);
     transition: width 0.3s;
 }

 /* Star Ratings */
 .lesson-stars {
     display: flex;
     gap: 0.1rem;
     margin-top: 0.5rem;
     font-size: 0.9rem;
     justify-content: center;
 }

 /* Progress States */
 .lesson-card.started {
     border-left: 3px solid var(--primary);
 }

 .lesson-card.practiced {
     border-left: 3px solid var(--warning);
 }

 .lesson-card.mastered {
     border-left: 3px solid var(--success);
     background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, var(--card-bg) 100%);
 }

 /* Badge Variants */
 .lesson-badge.warning-badge {
     background: rgba(239, 68, 68, 0.2);
     color: #ef4444;
 }

 .lesson-badge.tips-badge {
     background: rgba(245, 158, 11, 0.2);
     color: #f59e0b;
 }


 .level-badge {
     padding: 0.2rem 0.5rem;
     border-radius: 10px;
     font-size: 0.7rem;
     font-weight: 600;
 }

 .level-badge.beginner {
     background: rgba(34, 197, 94, 0.2);
     color: var(--success);
 }

 .level-badge.intermediate {
     background: rgba(245, 158, 11, 0.2);
     color: var(--warning);
 }

 .level-badge.advanced {
     background: rgba(239, 68, 68, 0.2);
     color: var(--danger);
 }

 /* Lesson Modal */
 .lesson-modal {
     display: none;
     position: fixed;
     top: 0;
     left: 0;
     right: 0;
     bottom: 0;
     background: var(--bg-color);
     z-index: 200;
     overflow-y: auto;
 }

 .lesson-modal.active {
     display: block;
 }

 .modal-header {
     position: fixed;
     top: 0;
     left: 0;
     right: 0;
     display: flex;
     align-items: center;
     gap: 0.75rem;
     padding: 0.75rem 1rem;
     background: var(--bg-color);
     border-bottom: 1px solid rgba(255, 255, 255, 0.1);
     z-index: 300;
 }

 .close-lesson {
     background: var(--card-bg);
     border: none;
     color: var(--text-color);
     width: 36px;
     height: 36px;
     border-radius: 50%;
     font-size: 1.25rem;
     cursor: pointer;
 }

 .modal-header h2 {
     font-size: 1rem;
     color: var(--primary);
     flex: 1;
 }

 .lesson-content {
     max-width: 700px;
     margin: 0 auto;
     padding: 4.5rem 1rem 2rem;
 }

 .lesson-section {
     background: var(--card-bg);
     border-radius: 12px;
     padding: 1.25rem;
     margin-bottom: 1rem;
 }

 .lesson-section h3 {
     font-size: 0.95rem;
     margin-bottom: 0.75rem;
     display: flex;
     align-items: center;
     gap: 0.5rem;
 }

 .lesson-section p {
     color: var(--text-muted);
     line-height: 1.6;
     margin-bottom: 0.75rem;
     font-size: 0.9rem;
 }

 .example-box {
     background: rgba(99, 102, 241, 0.1);
     border-left: 3px solid var(--primary);
     padding: 0.9rem;
     border-radius: 0 8px 8px 0;
     margin: 0.75rem 0;
 }

 .example-box .swe {
     font-size: 1rem;
     margin-bottom: 0.25rem;
     display: flex;
     align-items: center;
     gap: 0.5rem;
 }

 .example-box .arb {
     color: var(--text-muted);
     font-family: 'IBM Plex Sans Arabic', sans-serif;
     direction: rtl;
     font-size: 0.9rem;
 }

 .speak-btn {
     background: none;
     border: none;
     cursor: pointer;
     font-size: 1.2rem;
     opacity: 0.8;
 }

 .speak-btn:hover {
     opacity: 1;
     transform: scale(1.1);
 }

 .rule-highlight {
     background: linear-gradient(135deg, var(--primary) 0%, #8b5cf6 100%);
     color: white;
     padding: 1rem;
     border-radius: 8px;
     text-align: center;
     font-size: 1rem;
     margin: 0.75rem 0;
 }

 .rule-highlight strong {
     color: #fef08a;
 }

 /* Quiz Styles */
 .lesson-completion {
     margin-top: 2rem;
     text-align: center;
 }

 .quiz-start-btn {
     background: var(--primary);
     color: white;
     border: none;
     padding: 0.9rem 2rem;
     border-radius: 50px;
     font-size: 1rem;
     font-weight: 600;
     cursor: pointer;
     box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
     transition: all 0.3s;
     display: inline-flex;
     align-items: center;
     gap: 0.5rem;
 }

 .quiz-start-btn:hover {
     transform: translateY(-2px);
     box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
 }

 .quiz-container {
     max-width: 600px;
     margin: 0 auto;
     text-align: center;
 }

 .quiz-header {
     margin-bottom: 1.5rem;
 }

 .progress-bar {
     height: 6px;
     background: #334155;
     border-radius: 3px;
     margin-top: 0.75rem;
     overflow: hidden;
 }

 .progress-bar div {
     height: 100%;
     background: var(--primary);
     transition: width 0.3s;
 }

 .question-card {
     background: var(--card-bg);
     padding: 1.5rem;
     border-radius: 16px;
 }

 .question-text {
     font-size: 1.1rem;
     margin-bottom: 1.5rem;
     font-weight: 600;
 }

 .options-grid {
     display: grid;
     gap: 0.75rem;
 }

 .option-btn {
     background: var(--bg-color);
     border: 2px solid rgba(99, 102, 241, 0.1);
     padding: 0.9rem;
     border-radius: 8px;
     font-size: 0.95rem;
     cursor: pointer;
     transition: all 0.2s;
     color: var(--text-color);
     font-family: inherit;
 }

 .option-btn:hover {
     border-color: var(--primary);
     background: rgba(99, 102, 241, 0.05);
 }

 .option-btn.correct-answer {
     background: rgba(34, 197, 94, 0.2) !important;
     border-color: #22c55e !important;
     color: #22c55e !important;
 }

 .option-btn.wrong-answer {
     background: rgba(239, 68, 68, 0.2) !important;
     border-color: #ef4444 !important;
     color: #ef4444 !important;
     animation: shake 0.5s;
 }

 .option-btn:disabled {
     cursor: not-allowed;
     opacity: 0.8;
 }

 @keyframes shake {

     0%,
     100% {
         transform: translateX(0);
     }

     20%,
     60% {
         transform: translateX(-5px);
     }

     40%,
     80% {
         transform: translateX(5px);
     }
 }

 .answer-feedback {
     margin-top: 1.25rem;
     padding: 1rem;
     border-radius: 12px;
     text-align: center;
     font-weight: 600;
     animation: fadeIn 0.3s;
 }

 .feedback-correct-box {
     background: rgba(34, 197, 94, 0.15);
     border: 2px solid #22c55e;
     color: #22c55e;
 }

 .feedback-wrong-box {
     background: rgba(239, 68, 68, 0.15);
     border: 2px solid #ef4444;
     color: #ef4444;
 }

 @keyframes fadeIn {
     from {
         opacity: 0;
         transform: translateY(-10px);
     }

     to {
         opacity: 1;
         transform: translateY(0);
     }
 }

 /* Writing Quiz Styles */
 .writing-quiz {
     text-align: center;
 }

 .writing-input-container {
     display: flex;
     gap: 0.5rem;
     margin-top: 1.5rem;
 }

 .writing-input {
     flex: 1;
     padding: 0.9rem 1rem;
     border: 2px solid rgba(99, 102, 241, 0.3);
     border-radius: 12px;
     background: var(--bg-color);
     color: var(--text-color);
     font-size: 1.1rem;
     text-align: center;
     transition: all 0.3s;
 }

 .writing-input:focus {
     outline: none;
     border-color: var(--primary);
     box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
 }

 .writing-input.correct-input {
     border-color: #22c55e;
     background: rgba(34, 197, 94, 0.1);
 }

 .writing-input.wrong-input {
     border-color: #ef4444;
     background: rgba(239, 68, 68, 0.1);
     animation: shake 0.5s;
 }

 .check-writing-btn {
     padding: 0.9rem 1.25rem;
     background: var(--primary);
     color: white;
     border: none;
     border-radius: 12px;
     font-size: 0.95rem;
     font-weight: 600;
     cursor: pointer;
     transition: all 0.3s;
     white-space: nowrap;
 }

 .check-writing-btn:hover {
     background: var(--primary-dark);
     transform: translateY(-2px);
 }

 .check-writing-btn:disabled {
     opacity: 0.6;
     cursor: not-allowed;
 }

 .writing-feedback {
     margin-top: 1rem;
     padding: 0.75rem;
     text-align: center;
     font-weight: 600;
     animation: fadeIn 0.3s;
 }

 /* Sentence Fill Quiz Styles */
 .sentence-fill-quiz {
     text-align: center;
 }

 .sentence-container {
     background: var(--bg-color);
     border: 2px solid rgba(99, 102, 241, 0.2);
     border-radius: 12px;
     padding: 1.5rem;
     margin-bottom: 2rem;
     display: flex;
     justify-content: center;
     align-items: center;
     flex-wrap: wrap;
     gap: 0.5rem;
     min-height: 80px;
 }

 .sentence-word {
     display: inline-block;
     padding: 0.3rem 0.5rem;
     font-size: 1.2rem;
     border-radius: 4px;
 }

 .sentence-gap {
     display: inline-block;
     min-width: 100px;
     height: 40px;
     border-bottom: 2px dashed var(--primary);
     vertical-align: middle;
     margin: 0 0.5rem;
     color: var(--primary);
     font-weight: bold;
     text-align: center;
     line-height: 40px;
 }

 .sentence-gap.filled {
     border-bottom: 2px solid var(--success);
     color: var(--success);
     animation: fadeIn 0.3s;
 }

 /* Audio Quiz Styles */
 .audio-quiz {
     text-align: center;
 }

 .audio-player-large {
     background: var(--bg-color);
     width: 80px;
     height: 80px;
     border-radius: 50%;
     display: flex;
     align-items: center;
     justify-content: center;
     margin: 0 auto 2rem;
     cursor: pointer;
     box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
     transition: all 0.3s;
 }

 .audio-player-large:hover {
     transform: scale(1.1);
     background: var(--primary);
     color: white;
     box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
 }

 .audio-player-large.playing {
     animation: pulse-ring 1.5s infinite;
 }

 .audio-player-large svg {
     width: 40px;
     height: 40px;
 }

 @keyframes pulse-ring {
     0% {
         box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7);
     }

     70% {
         box-shadow: 0 0 0 20px rgba(99, 102, 241, 0);
     }

     100% {
         box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
     }
 }

 /* Reward Modal */
 .reward-modal {
     display: none;
     position: fixed;
     top: 0;
     left: 0;
     right: 0;
     bottom: 0;
     background: rgba(0, 0, 0, 0.9);
     z-index: 500;
     align-items: center;
     justify-content: center;
 }

 .reward-modal.active {
     display: flex;
     animation: fadeIn 0.5s;
 }

 .reward-content {
     background: var(--card-bg);
     padding: 2.5rem;
     border-radius: 24px;
     text-align: center;
     max-width: 90%;
     width: 350px;
     position: relative;
     border: 2px solid var(--primary);
     box-shadow: 0 0 50px rgba(99, 102, 241, 0.5);
     animation: slideInUp 0.5s;
 }

 @keyframes slideInUp {
     from {
         transform: translateY(50px);
         opacity: 0;
     }

     to {
         transform: translateY(0);
         opacity: 1;
     }
 }

 .reward-icon {
     font-size: 5rem;
     margin-bottom: 1rem;
     animation: bounce 2s infinite;
 }

 @keyframes bounce {

     0%,
     100% {
         transform: translateY(0);
     }

     50% {
         transform: translateY(-15px);
     }
 }

 .reward-title {
     font-size: 1.5rem;
     background: linear-gradient(135deg, #fbbf24, #d97706);
     -webkit-background-clip: text;
     background-clip: text;
     color: transparent;
     margin-bottom: 0.5rem;
 }

 .reward-score {
     font-size: 2rem;
     font-weight: 700;
     color: var(--text-color);
     margin: 1rem 0;
 }

 .xp-gain {
     color: #fbbf24;
     font-weight: 600;
     font-size: 1.1rem;
 }

 .reward-btn {
     background: var(--primary);
     color: white;
     border: none;
     padding: 1rem 2rem;
     border-radius: 50px;
     font-size: 1rem;
     font-weight: 600;
     cursor: pointer;
     width: 100%;
     margin-top: 1.5rem;
     transition: all 0.3s;
 }

 .reward-btn:hover {
     transform: translateY(-2px);
     box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
 }

 /* Confetti */
 .confetti {
     position: fixed;
     width: 10px;
     height: 10px;
     background-color: #f00;
     animation: confetti 5s ease-in-out infinite;
     z-index: 400;
 }

 @keyframes confetti {
     0% {
         transform: translateY(-10vh) rotate(0deg);
         opacity: 1;
     }

     100% {
         transform: translateY(110vh) rotate(720deg);
         opacity: 0;
     }
 }