<!DOCTYPE html>
<html lang="sv" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liknande Ord Pro | Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø§Øª - SnabbaLexin</title>
    <meta name="description"
        content="Ord som lÃ¥ter lika pÃ¥ svenska och arabiska. ÙƒÙ„Ù…Ø§Øª ØªØªØ´Ø§Ø¨Ù‡ ÙÙŠ Ø§Ù„Ù„ÙØ¸ ÙˆØ§Ù„Ù…Ø¹Ù†Ù‰ Ø¨ÙŠÙ† Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ©.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;600&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="cognates.css">
</head>

<body>
    <header>
        <button class="back-btn" onclick="window.location.href='learn.html'" aria-label="Tillbaka" title="Tillbaka">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        </button>
        <h1>Liknande Ord / Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø§Øª</h1>
        <div class="header-actions">
            <button class="action-btn secondary" onclick="openSavedModal()">â­ <span id="savedCount">0</span></button>
            <button class="action-btn" onclick="startQuiz()">ğŸ“ Quiz</button>
        </div>
    </header>

    <!-- Stats Bar -->
    <div class="stats-bar">
        <div class="stat-chip">ğŸ“š <span id="totalWords">673</span> ord</div>
        <div class="stat-chip learned">âœ… <span id="learnedCount">0</span> lÃ¤rt</div>
        <div class="stat-chip streak">ğŸ”¥ <span id="streakCount">0</span> streak</div>
    </div>

    <!-- Mode Tabs -->
    <div class="mode-tabs">
        <button class="mode-tab active" onclick="switchMode('browse')">ğŸ“– BlÃ¤ddra</button>
        <button class="mode-tab" onclick="switchMode('flashcard')">ğŸ´ Flashcards</button>
    </div>

    <main>
        <div class="intro-text">
            <p>Ord som lÃ¥ter lika pÃ¥ svenska och arabiska. Klicka fÃ¶r att lyssna! ğŸ”Š</p>
        </div>

        <!-- Browse View -->
        <div class="browse-view" id="browseView">
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="SÃ¶k ord / Ø§Ø¨Ø­Ø«...">
            </div>

            <div class="filter-chips" id="filterChips"></div>
            <div id="content"></div>
        </div>

        <!-- Flashcard View -->
        <div class="flashcard-container" id="flashcardView">
            <div class="flashcard-progress">
                <div class="progress-text"><span id="fcCurrent">0</span> / <span id="fcTotal">0</span></div>
                <div class="progress-bar">
                    <div class="fill" id="fcProgress"></div>
                </div>
            </div>

            <div class="flashcard" id="flashcard" onclick="flipCard()">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div class="flashcard-word" id="fcWord">Hej</div>
                        <div class="flashcard-hint">Klicka fÃ¶r att vÃ¤nda / Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ù„Ø¨</div>
                    </div>
                    <div class="flashcard-back">
                        <div class="flashcard-translation" id="fcTranslation">Ù…Ø±Ø­Ø¨Ø§Ù‹</div>
                        <div class="flashcard-type" id="fcType">Substantiv</div>
                    </div>
                </div>
            </div>

            <div class="flashcard-controls">
                <button class="fc-btn wrong" onclick="flashcardAnswer(false)">âŒ Inte Ã¤n</button>
                <button class="fc-btn correct" onclick="flashcardAnswer(true)">âœ… Kan det!</button>
            </div>
        </div>
    </main>

    <!-- Quiz Modal -->
    <div id="quizModal" class="quiz-modal">
        <button class="close-modal" onclick="closeQuiz()">Ã—</button>
        <div class="quiz-container" id="quizContent"></div>
    </div>

    <!-- Saved Words Modal -->
    <div id="savedModal" class="saved-modal" onclick="closeSavedModal(event)">
        <div class="saved-content" onclick="event.stopPropagation()">
            <div class="saved-header">
                <h2>â­ Sparade ord / Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
                <button class="close-modal close-modal-static" onclick="closeSavedModal()">Ã—</button>
            </div>
            <div class="saved-list" id="savedList">
                <p class="empty-state saved-empty">Inga sparade ord Ã¤nnu / Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
                </p>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/cognatesData.js"></script>
    <script>
        // ========== STATE ==========
        let currentMode = 'browse';
        let currentFilter = 'all';
        let savedWords = JSON.parse(localStorage.getItem('cognates_saved') || '[]');
        let learnedWords = JSON.parse(localStorage.getItem('cognates_learned') || '[]');
        let cognatesStreak = parseInt(localStorage.getItem('cognates_streak') || '0');

        // Flashcard state
        let fcCards = [];
        let fcIndex = 0;
        let fcKnown = 0;

        // Quiz state
        let quizState = null;
        let quizType = 'normal';

        const categoryIcons = {
            'Substantiv': 'ğŸ“¦', 'Adjektiv': 'ğŸ¨', 'Verb': 'ğŸƒ', 'Geografi': 'ğŸŒ',
            'Medicin & Vetenskap': 'ğŸ”¬', 'Musik & Konst': 'ğŸµ', 'Mat & Dryck': 'ğŸ½ï¸',
            'Teknik': 'ğŸ’»', 'Ã–vrigt': 'ğŸ“Œ'
        };

        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            if (localStorage.getItem('mobileView') === 'true') {
                document.documentElement.classList.add('iphone-mode');
                document.body.classList.add('iphone-view');
            }

            updateStats();
            renderFilterChips();
            renderContent(cognatesData);

            document.getElementById('searchInput').addEventListener('input', handleSearch);
        });

        // ========== MODE SWITCHING ==========
        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('browseView').classList.toggle('hidden', mode !== 'browse');
            document.getElementById('flashcardView').classList.toggle('active', mode === 'flashcard');

            if (mode === 'flashcard') initFlashcards();
        }

        // ========== STATS ==========
        function updateStats() {
            document.getElementById('totalWords').textContent = cognatesData.length;
            document.getElementById('learnedCount').textContent = learnedWords.length;
            document.getElementById('savedCount').textContent = savedWords.length;
            document.getElementById('streakCount').textContent = cognatesStreak;
        }

        function saveState() {
            localStorage.setItem('cognates_saved', JSON.stringify(savedWords));
            localStorage.setItem('cognates_learned', JSON.stringify(learnedWords));
            localStorage.setItem('cognates_streak', cognatesStreak);
            updateStats();
        }

        // ========== BROWSE VIEW ==========
        function handleSearch(e) {
            const term = e.target.value.toLowerCase().trim();
            let filtered = cognatesData.filter(item =>
                item.swe.toLowerCase().includes(term) || item.arb.includes(term)
            );
            if (currentFilter !== 'all') {
                filtered = filtered.filter(item => item.category === currentFilter);
            }
            renderContent(filtered, term);
        }

        function renderFilterChips() {
            const container = document.getElementById('filterChips');
            const categories = ['all', ...new Set(cognatesData.map(c => c.category))];
            container.innerHTML = categories.map(cat => `
                <button class="chip ${cat === 'all' ? 'active' : ''}" onclick="filterByCategory('${cat}')">
                    ${cat === 'all' ? 'ğŸŒ Alla' : (categoryIcons[cat] || 'ğŸ“Œ') + ' ' + cat}
                </button>
            `).join('');
        }

        function filterByCategory(cat) {
            currentFilter = cat;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            handleSearch({ target: document.getElementById('searchInput') });
        }

        function renderContent(data, searchTerm = '') {
            const container = document.getElementById('content');
            if (data.length === 0) {
                container.innerHTML = '<div class="empty-state">Inga ord hittades / Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
                return;
            }

            const grouped = {};
            data.forEach(item => {
                const cat = item.category || 'Ã–vrigt';
                if (!grouped[cat]) grouped[cat] = [];
                grouped[cat].push(item);
            });

            let html = '';
            for (const [category, items] of Object.entries(grouped)) {
                html += `
                    <div class="category-section">
                        <div class="category-title">
                            <span>${categoryIcons[category] || 'ğŸ“Œ'}</span>
                            <span>${category} (${items.length})</span>
                        </div>
                        <div class="cognates-grid">
                            ${items.map(item => {
                    const isSaved = savedWords.includes(item.swe);
                    const isLearned = learnedWords.includes(item.swe);
                    return `
                                <div class="cognate-card ${isLearned ? 'learned' : ''} ${isSaved ? 'saved' : ''}" onclick="playTTS('${item.swe.replace(/'/g, "\\'")}')">
                                    <div>
                                        <span class="word-swe">${item.swe}</span>
                                        <span class="speaker-icon">ğŸ”Š</span>
                                        ${item.type ? `<span class="word-type">${item.type}</span>` : ''}
                                    </div>
                                    <div class="flex-center-gap">
                                        <span class="word-arb">${item.arb}</span>
                                        <button class="mini-btn ${isSaved ? 'saved' : ''}" onclick="event.stopPropagation(); toggleSave('${item.swe}')">${isSaved ? 'â­' : 'â˜†'}</button>
                                    </div>
                                </div>`;
                }).join('')}
                        </div>
                    </div>`;
            }
            container.innerHTML = html;
        }

        function playTTS(text) {
            if (typeof TTSManager !== 'undefined') {
                TTSManager.speak(text, 'sv');
            } else {
                console.error('TTSManager not loaded');
            }
        }

        function toggleSave(word) {
            const idx = savedWords.indexOf(word);
            if (idx > -1) {
                savedWords.splice(idx, 1);
            } else {
                savedWords.push(word);
            }
            saveState();
            handleSearch({ target: document.getElementById('searchInput') });
        }

        // ========== SAVED MODAL ==========
        function openSavedModal() {
            const list = document.getElementById('savedList');
            if (savedWords.length === 0) {
                list.innerHTML = '<p class="empty-state saved-empty">Inga sparade ord Ã¤nnu / Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>';
            } else {
                list.innerHTML = savedWords.map(word => {
                    const item = cognatesData.find(c => c.swe === word);
                    return `
                        <div class="saved-item">
                            <div>
                                <strong>${word}</strong>
                                <span class="saved-arb">${item?.arb || ''}</span>
                            </div>
                            <button class="mini-btn" onclick="toggleSave('${word}'); openSavedModal();">âŒ</button>
                        </div>`;
                }).join('');
            }
            document.getElementById('savedModal').classList.add('active');
        }

        function closeSavedModal(e) {
            if (!e || e.target === document.getElementById('savedModal')) {
                document.getElementById('savedModal').classList.remove('active');
            }
        }

        // ========== FLASHCARDS ==========
        function initFlashcards() {
            let pool = currentFilter === 'all' ? cognatesData : cognatesData.filter(c => c.category === currentFilter);
            fcCards = [...pool].sort(() => 0.5 - Math.random());
            fcIndex = 0;
            fcKnown = 0;
            showFlashcard();
        }

        function showFlashcard() {
            if (fcIndex >= fcCards.length) {
                finishFlashcards();
                return;
            }

            const card = fcCards[fcIndex];
            document.getElementById('fcWord').textContent = card.swe;
            document.getElementById('fcTranslation').textContent = card.arb;
            document.getElementById('fcType').textContent = card.type || card.category;
            document.getElementById('fcCurrent').textContent = fcIndex + 1;
            document.getElementById('fcTotal').textContent = fcCards.length;
            document.getElementById('fcProgress').style.width = ((fcIndex / fcCards.length) * 100) + '%';
            document.getElementById('flashcard').classList.remove('flipped');
        }

        function flipCard() {
            document.getElementById('flashcard').classList.toggle('flipped');
            playTTS(fcCards[fcIndex].swe);
        }

        function flashcardAnswer(known) {
            if (known) {
                fcKnown++;
                if (!learnedWords.includes(fcCards[fcIndex].swe)) {
                    learnedWords.push(fcCards[fcIndex].swe);
                    saveState();
                }
            }
            fcIndex++;
            showFlashcard();
        }

        function finishFlashcards() {
            cognatesStreak++;
            saveState();
            const percent = Math.round((fcKnown / fcCards.length) * 100);
            document.getElementById('flashcardView').innerHTML = `
    <div class="result-container">
        <div class="result-icon">${percent >= 70 ? 'ğŸ‰' : 'ğŸ“š'}</div>
        <div class="result-title">${percent >= 70 ? 'Bra jobbat!' : 'FortsÃ¤tt Ã¶va!'}</div>
        <div class="result-score">${fcKnown} / ${fcCards.length} ord (${percent}%)</div>
        <div class="result-actions">
            <button class="result-btn primary" onclick="location.reload()">ğŸ”„ Igen</button>
            <button class="result-btn secondary" onclick="switchMode('browse')">â† Tillbaka</button>
        </div>
    </div>`;
        }

        // ========== QUIZ ==========
        function startQuiz() {
            let pool = currentFilter === 'all' ? cognatesData : cognatesData.filter(c => c.category === currentFilter);
            if (pool.length < 4) { alert('Inte tillrÃ¤ckligt med ord!'); return; } const shuffled = [...pool].sort(() => 0.5 -
                Math.random());
            quizState = {
                questions: shuffled.slice(0, 10),
                index: 0,
                score: 0,
                pool: pool
            };

            document.getElementById('quizModal').classList.add('active');
            renderQuizTypeSelector();
        }

        function closeQuiz() {
            document.getElementById('quizModal').classList.remove('active');
            quizState = null;
        }

        function renderQuizTypeSelector() {
            document.getElementById('quizContent').innerHTML = `
        <div class="quiz-header">
            <h2>VÃ¤lj Quiz-typ / Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
        </div>
        <div class="quiz-type-selector quiz-type-selector-col">
            <button class="quiz-type-btn quiz-type-btn-large" onclick="setQuizType('normal')">
                ğŸ‡¸ğŸ‡ªâ†’ğŸ‡¸ğŸ‡¦ Svenska â†’ Arabiska
            </button>
            <button class="quiz-type-btn quiz-type-btn-large" onclick="setQuizType('reverse')">
                ğŸ‡¸ğŸ‡¦â†’ğŸ‡¸ğŸ‡ª Arabiska â†’ Svenska
            </button>
            <button class="quiz-type-btn quiz-type-btn-large" onclick="setQuizType('audio')">
                ğŸ”Š Lyssna â†’ VÃ¤lj
            </button>
            <button class="quiz-type-btn quiz-type-btn-large" onclick="setQuizType('write')">
                âœï¸ Skriv svaret
            </button>
        </div>`;
        }

        function setQuizType(type) {
            quizType = type;
            renderQuizQuestion();
        }

        function renderQuizQuestion() {
            const q = quizState.questions[quizState.index];
            const total = quizState.questions.length;

            const wrongPool = quizState.pool.filter(c => c.swe !== q.swe);
            const wrongOptions = wrongPool.sort(() => 0.5 - Math.random()).slice(0, 3);

            let html = `
        <div class="quiz-header">
            <h2>FrÃ¥ga ${quizState.index + 1} / ${total}</h2>
            <div class="progress-bar">
                <div class="fill" style="width: ${(quizState.index / total) * 100}%"></div>
            </div>
        </div>
        <div class="question-card">`;

            if (quizType === 'normal') {
                const options = [q.arb, ...wrongOptions.map(c => c.arb)].sort(() => 0.5 - Math.random());
                html += `
            <div class="question-text">${q.swe}</div>
            <div class="question-hint">VÃ¤lj rÃ¤tt arabisk Ã¶versÃ¤ttning / Ø§Ø®ØªØ± Ø§Ù„ØªØ±Ø¬Ù…Ø©</div>
            <div class="options-grid" id="optionsGrid">
                ${options.map(opt => `<button class="option-btn arb" data-correct="${opt === q.arb}"
                    onclick="checkAnswer(this, ${opt === q.arb})">${opt}</button>`).join('')}
            </div>`;
            } else if (quizType === 'reverse') {
                const options = [q.swe, ...wrongOptions.map(c => c.swe)].sort(() => 0.5 - Math.random());
                html += `
            <div class="question-text arabic-font">${q.arb}</div>
            <div class="question-hint">VÃ¤lj rÃ¤tt svenskt ord / Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ©</div>
            <div class="options-grid" id="optionsGrid">
                ${options.map(opt => `<button class="option-btn" data-correct="${opt === q.swe}"
                    onclick="checkAnswer(this, ${opt === q.swe})">${opt}</button>`).join('')}
            </div>`;
            } else if (quizType === 'audio') {
                const options = [q.arb, ...wrongOptions.map(c => c.arb)].sort(() => 0.5 - Math.random());
                html += `
            <div class="question-text"><button class="action-btn" onclick="playTTS('${q.swe}')">ğŸ”Š Lyssna</button></div>
            <div class="question-hint">Vad hÃ¶rde du? / Ù…Ø§Ø°Ø§ Ø³Ù…Ø¹ØªØŸ</div>
            <div class="options-grid" id="optionsGrid">
                ${options.map(opt => `<button class="option-btn arb" data-correct="${opt === q.arb}"
                    onclick="checkAnswer(this, ${opt === q.arb})">${opt}</button>`).join('')}
            </div>`;
                setTimeout(() => playTTS(q.swe), 500);
            } else if (quizType === 'write') {
                html += `
            <div class="question-text">${q.swe}</div>
            <div class="question-hint">Skriv den arabiska Ã¶versÃ¤ttningen / Ø§ÙƒØªØ¨ Ø§Ù„ØªØ±Ø¬Ù…Ø©</div>
            <input type="text" class="writing-input" id="writeAnswer" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..." dir="rtl">
            <button class="submit-btn" onclick="checkWrittenAnswer('${q.arb}')">Kontrollera / ØªØ­Ù‚Ù‚</button>`;
            }

            html += `<div class="feedback" id="feedback"></div>
        </div>`;
            document.getElementById('quizContent').innerHTML = html;
        }

        function checkAnswer(btn, isCorrect) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => {
                b.disabled = true;
                if (b.getAttribute('data-correct') === 'true') b.classList.add('correct');
                else if (b === btn && !isCorrect) b.classList.add('wrong');
            });

            showFeedback(isCorrect);
        }

        function checkWrittenAnswer(correctAnswer) {
            const input = document.getElementById('writeAnswer').value.trim();
            const isCorrect = input === correctAnswer || input.includes(correctAnswer) || correctAnswer.includes(input);
            document.getElementById('writeAnswer').disabled = true;
            document.querySelector('.submit-btn').disabled = true;
            showFeedback(isCorrect, correctAnswer);
        }

        function showFeedback(isCorrect, correctAnswer = null) {
            const feedback = document.getElementById('feedback');
            feedback.classList.add('show');
            if (isCorrect) {
                quizState.score++;
                feedback.className = 'feedback show correct';
                feedback.innerHTML = 'âœ… RÃ¤tt! / ØµØ­ÙŠØ­!';
            } else {
                feedback.className = 'feedback show wrong';
                feedback.innerHTML = `âŒ Fel! ${correctAnswer ? 'RÃ¤tt: ' + correctAnswer : ''}`;
            }

            setTimeout(() => {
                quizState.index++;
                if (quizState.index < quizState.questions.length) renderQuizQuestion(); else showQuizResults();
            }, 1500);
        }
        function showQuizResults() {
            const score = quizState.score; const total = quizState.questions.length; const
                percent = Math.round((score / total) * 100); const passed = percent >= 60;

            if (passed) cognatesStreak++;
            saveState();

            document.getElementById('quizContent').innerHTML = `
            <div class="result-container">
                <div class="result-icon">${passed ? 'ğŸ‰' : 'ğŸ˜•'}</div>
                <div class="result-title">${passed ? 'Grattis! / Ù…Ø¨Ø±ÙˆÙƒ!' : 'FÃ¶rsÃ¶k igen'}</div>
                <div class="result-score">${score} / ${total} rÃ¤tt (${percent}%)</div>
                <div class="result-actions">
                    <button class="result-btn primary" onclick="startQuiz()">ğŸ”„ GÃ¶r om</button>
                    <button class="result-btn secondary" onclick="closeQuiz()">â† Tillbaka</button>
                </div>
            </div>`;
        }
    </script>
    <script src="utils.js"></script>
    <script src="pwa.js" defer></script>
</body>

</html>